<xf:title>{{ phrase_dynamic('sylphian_library_logs_for_addon', {'addon': $addon.title}) }}</xf:title>

<xf:pageaction>
    <xf:button href="{{ link('logs/addon_logs') }}">
        <xf:fa icon="fa-arrow-left" />
        {{ phrase('sylphian_library_back_to_addons') }}
    </xf:button>

    <xf:button href="{{ link('logs/addon_logs/clear', null, {'addon_id': $addonId}) }}"
               overlay="true"
               icon="delete" >
        {{ phrase_dynamic('sylphian_library_clear_addon_logs', {'addon': $addonId}) }}
    </xf:button>
</xf:pageaction>

<div class="block">
	<br>
	
    <xf:form action="{{ link('logs/addon_logs/view', null, {'addon_id': $addonId}) }}" class="block">
        <div class="block-container">
            <h2 class="block-header">Filtering options</h2>
            <div class="block-body">
                <xf:datalist>
                    <xf:datarow rowtype="header">
                        <xf:cell colspan="2" width="30%">{{ phrase('date') }}</xf:cell>
                        <xf:cell width="41%">{{ phrase('type') }}</xf:cell>
                        <xf:cell>{{ phrase('user') }}</xf:cell>
                        <xf:cell></xf:cell>
                        <xf:cell></xf:cell>
                    </xf:datarow>
                    
                    <xf:datarow>
                        <xf:cell width="10%">Start date:</xf:cell>
                        <xf:cell width="20%"><xf:datetimeinput name="start_date" value="{$filters.start_date}" /></xf:cell>
                        <xf:cell width="41%" rowspan="2">
                            <xf:select name="type" value="{$filters.type}" multiple="true">
                                <xf:option value="any">{{ phrase('any') }}</xf:option>
                                <xf:options source="$filterBits.types" />
                            </xf:select>
                        </xf:cell>
                        <xf:cell rowspan="2">
                            <xf:select name="user_id" value="{$filters.user_id}" multiple="true" class="input--inline">
                                <xf:option value="0">{{ phrase('any') }}</xf:option>
                                <xf:options source="$filterBits.users" />
                            </xf:select>
                        </xf:cell>
                        <xf:cell rowspan="2"></xf:cell>
                        <xf:cell rowspan="2"></xf:cell>
                    </xf:datarow>
                    
                    <xf:datarow>
                        <xf:cell width="10%">End date:</xf:cell>
                        <xf:cell width="20%"><xf:datetimeinput name="end_date" value="{$filters.end_date}" /></xf:cell>
                    </xf:datarow>
                </xf:datalist>
            </div>
            <div class="block-footer" align="center">
                <xf:button type="submit">Apply filters</xf:button>
            </div>
        </div>
    </xf:form>

<xf:if is="$logs is not empty">
        <div class="block-container">
            <div class="block-body">
                <xf:datalist>
                    <xf:datarow rowtype="header">
                        <xf:cell width="30%">{{ phrase('date') }}</xf:cell>
                        <xf:cell>{{ phrase('type') }}</xf:cell>
                        <xf:cell>{{ phrase('message') }}</xf:cell>
                        <xf:cell>{{ phrase('user') }}</xf:cell>
                        <xf:cell></xf:cell>
                        <xf:cell></xf:cell>
                    </xf:datarow>
                    <xf:foreach loop="$logs" value="$log">
                        <xf:datarow>
                            <xf:cell>{{ date($log.date, 'M j, Y g:i a') }}</xf:cell>
                            <xf:cell>
								<span class="label log-label log-type-{{ $log.type }}">
									<xf:fa icon="{{ 
										$log.type == 'emergency' ? 'fa-exclamation-triangle' : 
										($log.type == 'alert' ? 'fa-bell' : 
										($log.type == 'critical' ? 'fa-times' : 
										($log.type == 'error' ? 'fa-times' : 
										($log.type == 'warning' ? 'fa-exclamation-triangle' : 
										($log.type == 'notice' ? 'fa-info-circle' :
										($log.type == 'info' ? 'fa-info-circle' : 'fa-bug')))))) }}" />
									{{ phrase_dynamic("sylphian_library_logType_" . $log.type) }}
								</span>
                            </xf:cell>
                            <xf:cell>{{ $log.content }}</xf:cell>
                            <xf:cell>
                                <xf:if is="$log.User">
                                    <xf:username user="$log.User" />
                                    <xf:else />
                                    {{ phrase('system') }}
                                </xf:if>
                            </xf:cell>
                            <xf:action href="{{ link('logs/addon_logs/details', null, {'log_id': $log.log_id}) }}"
                                       overlay="true"
                                       title="{{ phrase('sylphian_library_view_addon_log_details') }}">
                                <xf:fa icon="fa-search" />
                            </xf:action>

                            <xf:action href="{{ link('logs/addon_logs/delete', null, {'log_id': $log.log_id}) }}"
                                       overlay="true"
                                       title="{{ phrase('sylphian_library_delete_addon_log') }}">
                                <xf:fa icon="fa-trash" />
                            </xf:action>
                        </xf:datarow>
                    </xf:foreach>
                </xf:datalist>
            </div>
        </div>

		<xf:pagenav page="{$page}" perpage="{$perPage}" total="{$total}"
				link="logs/addon_logs/view"
				params="{{ {
					'addon_id': $addonId,
					'start_date': $filters.start_date,
					'end_date': $filters.end_date,
					'type': $filters.type,
					'user_id': $filters.user_id
				} }}"
				wrapperclass="block-outer block-outer--after" />
	
    <xf:else />
    <div class="blockMessage">{{ phrase('sylphian_library_no_logs_available', {'addon': $addon ? $addon.title : $addonId}) }}</div>
</xf:if>
</div>

<xf:css src="log_styles.less" />